name: SonarQube Analysis

on:
  push:
    branches:
      - main

jobs:
  build:
    runs-on: windows-latest
    steps:
      - uses: actions/checkout@v3

      - name: Set up JDK 17
        uses: actions/setup-java@v1
        with:
          java-version: '17'

      - name: Download and Install SonarScanner
        run: |
          Invoke-WebRequest -Uri "https://binaries.sonarsource.com/Distribution/sonar-scanner-cli/sonar-scanner-cli-4.8.0.2856-windows.zip" -OutFile "sonar-scanner.zip"
          Expand-Archive sonar-scanner.zip -DestinationPath "C:\sonar-scanner"
          echo "SONAR_SCANNER_HOME=C:\sonar-scanner\sonar-scanner-4.8.0.2856-windows" >> $Env:GITHUB_ENV
          echo "$Env:PATH=C:\sonar-scanner\sonar-scanner-4.8.0.2856-windows\bin;$Env:PATH" >> $Env:GITHUB_ENV

      - name: Run SonarQube Scan
        run: |
          sonar-scanner.bat -D"sonar.projectKey=sonnerqube-testing" -D"sonar.sources=." -D"sonar.host.url=http://localhost:9000" -D"sonar.login=sqp_afcc5a2aed17c94646242e7d00b9f67025428312"
        env:
          JAVA_HOME: C:\hostedtoolcache\windows\jdk\11.0.10\x64
